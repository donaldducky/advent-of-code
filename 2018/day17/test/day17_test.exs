defmodule Day17Test do
  use ExUnit.Case
  doctest Day17
  import Day17

  test "water flow does not continue forever" do
    map = """
    ......+.......
    ............#.
    .#..#.......#.
    .#..#..#......
    .#..#..#......
    .#.....#......
    .#.....#......
    .#####.#......
    ..............
    ..............
    ....#.....#...
    ....#.....#...
    ....#.....#...
    ....##.####...
    """

    expect = """
    ......+.......
    ......|.....#.
    .#..#.|.....#.
    .#..#.|#......
    .#..#.|#......
    .#....|#......
    .#....|#......
    .#####|#......
    ......|.......
    ......|.......
    ....#.|...#...
    ....#.|...#...
    ....#.|...#...
    ....##|####...
    """

    assert generate_water_flow(read_map(map)) == read_map(expect)
  end

  test "water flow" do
    map = """
    ......+.......
    ............#.
    .#..#.......#.
    .#..#..#......
    .#..#..#......
    .#.....#......
    .#.....#......
    .#######......
    ..............
    ..............
    ....#.....#...
    ....#.....#...
    ....#.....#...
    ....#######...
    """

    expect = """
    ......+.......
    ......|.....#.
    .#..#||||...#.
    .#..#~~#|.....
    .#..#~~#|.....
    .#~~~~~#|.....
    .#~~~~~#|.....
    .#######|.....
    ........|.....
    ...|||||||||..
    ...|#~~~~~#|..
    ...|#~~~~~#|..
    ...|#~~~~~#|..
    ...|#######|..
    """

    # assert generate_water_flow(read_map(map)) == read_map(expect)
  end

  test "count_tiles" do
    expect = """
    ......+.......
    ......|.....#.
    .#..#||||...#.
    .#..#~~#|.....
    .#..#~~#|.....
    .#~~~~~#|.....
    .#~~~~~#|.....
    .#######|.....
    ........|.....
    ...|||||||||..
    ...|#~~~~~#|..
    ...|#~~~~~#|..
    ...|#~~~~~#|..
    ...|#######|..
    """

    assert count_water_tiles(read_map(expect)) == 57
  end
end
